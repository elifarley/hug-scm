test -e "$HOME"/.hug-scm || {
  echo "$HOME/.hug-scm is missing. Before activating Hug, you must install it by running:"
  echo "  make install"
  exit 1
}

. "$HOME"/.hug-scm
export HUG_HOME PATH="$HUG_HOME/bin:$HUG_HOME/git-config/bin:$PATH:$HOME/.hug-deps/bin"
alias h=hug
alias g=hug

# Hug bash completion
if [[ -r "$HUG_HOME/completions/hug-completion.bash" ]]; then
  source "$HUG_HOME/completions/hug-completion.bash"
fi

complete -F _hug h

# Worktree switching function - this can change the current directory
# The underlying git-wt script outputs WORKTREE_PATH:/path/to/worktree for shell integration
wt() {
    local worktree_path
    worktree_path=$(git-wt "$@" | grep "^WORKTREE_PATH:" | cut -d: -f2-)

    if [[ -n "$worktree_path" && -d "$worktree_path" ]]; then
        cd "$worktree_path" || {
            echo "Failed to change to worktree directory: $worktree_path" >&2
            return 1
        }
        # Show current context after switching
        local current_branch
        current_branch=$(git branch --show-current 2>/dev/null || echo "detached")
        echo "âœ“ Switched to worktree: ${worktree_path/#$HOME/~}"
        echo "  Current branch: $current_branch"
    else
        # No worktree selected or git-wt failed/returned nothing
        return 1
    fi
}

# Hug Fish completion

test -r "$HUG_HOME/completions/hug.fish" && \
  mkdir -p ~/.config/fish/completions && \
  \cp -f "$HUG_HOME/completions/hug.fish" "$HOME"/.config/fish/completions/

: Exit code set to 0
