#!/usr/bin/env bash
CMD_BASE="$(readlink -f "$0" 2>/dev/null || greadlink -f "$0")" || CMD_BASE="$0"; CMD_BASE="$(dirname "$CMD_BASE")"
. "$CMD_BASE/../lib/hug-common"
set -euo pipefail  # Exit on error, undefined vars, pipe failures
# Part of the Hug tool suite

show_help() {
    cat << EOF
h back: Take back commits but keep everything ready: HEAD goes back, keeps their changes staged.

USAGE:
    hug h back [N|COMMIT]

DESCRIPTION:
    Deletes the specified commits and moves the HEAD back.
    Changes introduced by the removed commits are kept (staged).
    Working directory isn't affected at all.

EXAMPLES:
    hug h back        # delete last commit, keep changes staged
    hug h back 3      # delete last 3 commits, keep changes staged
    hug h back a1b2c3 # delete commits AFTER specified commit, keep changes staged

SEE ALSO:
    hug h undo          Take back commits and keep their changes unstaged.
EOF
}

case "${1:-}" in
  -h|--help)
    show_help
    exit 1;;
  '') target='HEAD~1' ;;
  [1-9]|[1-9][0-9]|[1-9][0-9][0-9]) target="HEAD~$1" ;;
  *) target="$1" ;;
esac
git reset --soft "$target"

